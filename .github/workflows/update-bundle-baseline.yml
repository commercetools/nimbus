name: Update Bundle Size Baseline

on:
  workflow_dispatch:
  push:
    branches: [main]
    paths:
      - "packages/nimbus/src/**"
      - "packages/tokens/**"

jobs:
  update-baseline:
    runs-on: ubuntu-latest
    container:
      image: mcr.microsoft.com/playwright:v1.58.0-noble

    steps:
      - uses: actions/checkout@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Mark workspace as safe for git
        run: git config --global --add safe.directory "$GITHUB_WORKSPACE"

      - uses: ./.github/actions/ci

      - name: Update bundle size baseline
        run: node scripts/check-bundle-size.mjs --update-baseline

      - name: Upload baseline to gist
        env:
          GH_TOKEN: ${{ secrets.GIST_PAT }}
        run: gh gist edit ${{ vars.BUNDLE_BASELINE_GIST_ID }} .bundle-baseline/bundle-size-baseline.json
