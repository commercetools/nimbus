# i18n Files ({component}.i18n.ts)

## Overview

Internationalization (i18n) files contain translatable message definitions for
components. These files are source files used for extraction to translation
workflows (Transifex). At runtime, components use compiled message dictionaries
(`*.messages.ts`) generated from these source files. This ensures consistent,
accessible, and translatable user interface text across all supported locales.

## Purpose

i18n files serve to:

- Define translatable strings for accessibility labels (aria-label,
  aria-description)
- Provide user-facing text that needs localization
- Ensure consistent message ID structure across the design system
- Support professional translation workflows via Transifex

## When to Use

### All Components Need i18n UNLESS:

- Component has **NO default labels or aria-labels set** (pure layout components
  like Box, Card, Stack)
- Component only renders children without adding accessibility text
- Component is purely styling/layout with no user-facing text

### Components That Need i18n:

- Components with **accessibility labels** (aria-label, aria-description)
- Components with **interactive elements** (buttons, inputs, controls)
- Components with **default placeholder text** or helper text
- Components with **tooltips or user-facing messages**

### Examples

**Components that DON'T need i18n:**

- Box, Card, Stack (pure layout)
- Badge (if no default aria-label)
- Divider, Separator (visual only)

**Components that DO need i18n:**

- Button (if sets default aria-label)
- NumberInput (increment/decrement labels)
- Alert (dismiss button label)
- DatePicker (input placeholders, button labels)

## File Structure

### Location

```
src/components/{component-name}/{component-name}.i18n.ts
```

### Basic Template

> **Note:** `.i18n.ts` files are **source files for extraction only**. They are
> plain TypeScript objects extracted by a custom script during build. Components
> do NOT import these files at runtime - they use compiled `*.messages.ts`
> dictionaries instead.

```typescript
export const messages = {
  dismiss: {
    id: "Nimbus.Alert.dismiss",
    description: "aria-label for dismiss button in alert",
    defaultMessage: "Dismiss",
  },
  // Additional messages...
};
```

**Build Process:**

1. `.i18n.ts` files â†’ extracted by custom script (`pnpm extract-intl`) â†’
   `packages/i18n/data/core.json`
2. Translation workflow â†’ `data/*.json` files translated via Transifex
3. Build pipeline â†’ compiles messages â†’ generates `*.messages.ts` dictionaries
4. Components â†’ import and use `*.messages.ts` at runtime

## Message ID Convention

All message IDs must follow the hierarchical naming pattern:

```
Nimbus.{ComponentName}.{messageKey}
```

### Examples

- `Nimbus.Alert.dismiss`
- `Nimbus.DatePicker.clearInput`
- `Nimbus.NumberInput.increment`
- `Nimbus.PasswordInput.show`

For nested or complex components:

```
Nimbus.{ComponentName}.{SubComponent}.{messageKey}
```

Example: `Nimbus.DatePicker.Time.enterTimeHour`

## Message Properties

Each message must include:

- **id**: Unique identifier following naming convention
- **description**: Developer-facing context (appears in translation files)
- **defaultMessage**: English fallback text

```typescript
{
  id: "Nimbus.Select.clearSelection",
  description: "aria-label for select clear button",
  defaultMessage: "Clear selection",
}
```

## Component Integration

> ğŸ“– **For user-facing documentation on setting up locale, see
> [NimbusProvider documentation](../../packages/nimbus/src/components/nimbus-provider/nimbus-provider.mdx#set-up-locale)**

### Import Pattern

```typescript
import { useLocalizedStringFormatter } from "@/hooks";
import { componentMessagesStrings } from "./component.messages";
```

### Usage in Components

Using `useLocalizedStringFormatter` hook automatically handles locale from
context and provides a clean API:

```typescript
import { useLocalizedStringFormatter } from "@/hooks";
import { alertMessagesStrings } from "./alert.messages";

export const AlertDismissButton = (props: AlertDismissButtonProps) => {
  const msg = useLocalizedStringFormatter(alertMessagesStrings);

  return (
    <button
      aria-label={msg.format("dismiss")}
      {...props}
    >
      ...
    </button>
  );
};
```

### With Dynamic Values

For messages with variables, pass the arguments as the second parameter:

```typescript
const msg = useLocalizedStringFormatter(avatarMessagesStrings);

// Simple message (no variables)
const label = msg.format("dismiss");

// Variable message (with interpolation)
const label = msg.format("avatarLabel", {
  fullName: user.name,
});
```

## Locale Resolution

Understanding how components retrieve locale is crucial for debugging and
testing.

### How Locale Flows

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Locale Resolution Architecture                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Component calls useLocalizedStringFormatter hook
  â”‚
  â””â”€â†’ Hook internally calls useLocale() from react-aria-components
      â”‚
      â””â”€â†’ Reads from React Aria I18nProvider context
      â”‚
      â”œâ”€â†’ Nearest NimbusI18nProvider (if nested)
      â”‚   â”‚
      â”‚   â””â”€â†’ Wraps React Aria's I18nProvider
      â”‚
      â”œâ”€â†’ Parent NimbusProvider (if no nested provider)
      â”‚   â”‚
      â”‚   â””â”€â†’ NimbusI18nProvider (receives locale prop)
      â”‚       â”‚
      â”‚       â””â”€â†’ Wraps React Aria's I18nProvider
      â”‚
      â””â”€â†’ Browser default (navigator.language) if no provider

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Precedence Order                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Highest Priority (most specific)
  â†“
1. Nested NimbusI18nProvider locale prop
2. Nested NimbusProvider locale prop
3. Parent NimbusProvider locale prop
4. Browser locale (navigator.language)
  â†“
Lowest Priority (fallback)
```

### Technical Details

- **Hook**: Components use `useLocalizedStringFormatter` which internally calls
  `useLocale()` from `react-aria-components`
- **Context Source**: Locale comes from React Aria's `I18nProvider` context
- **Provider Chain**: `NimbusProvider` â†’ `NimbusI18nProvider` â†’ `I18nProvider`
  (React Aria)
- **Nested Override**: Nested providers override parent providers (React Context
  behavior)
- **Fallback**: If no provider is found, React Aria falls back to browser locale

### Common Patterns

**Single Locale App:**

```tsx
<NimbusProvider locale="en">
  <App />
</NimbusProvider>
```

**Nested Locale Override:**

```tsx
<NimbusProvider locale="en">
  <MainContent />
  <NimbusI18nProvider locale="de">
    <GermanSection />
  </NimbusI18nProvider>
</NimbusProvider>
```

**Testing with Specific Locale:**

```tsx
// In Storybook stories or tests
<NimbusI18nProvider locale="de">
  <Component />
</NimbusI18nProvider>
```

## Components with Multiple Parts

### Single i18n File Per Component

**Components with multiple internal parts share a single i18n file** regardless
of how many parts they have. All messages for the entire component (whether
compound components like Menu or complex single components like DatePicker) are
defined in one file.

```typescript
// alert.i18n.ts - Single file for entire Alert compound component
export const messages = {
  dismiss: {
    id: "Nimbus.Alert.dismiss",
    description: "aria-label for dismiss button in Alert.DismissButton",
    defaultMessage: "Dismiss",
  },
  // Additional messages for other Alert parts...
};
```

## React Aria Integration

When using React Aria hooks, pass localized labels from message dictionaries:

```typescript
import { useLocalizedStringFormatter } from "@/hooks";
import { numberInputMessagesStrings } from "./number-input.messages";

export const NumberInput = (props: NumberInputProps) => {
  const msg = useLocalizedStringFormatter(numberInputMessagesStrings);

  const ariaProps = {
    ...functionalProps,
    incrementAriaLabel: msg.format("increment"),
    decrementAriaLabel: msg.format("decrement"),
  };

  const { inputProps, incrementButtonProps, decrementButtonProps } =
    useNumberField(ariaProps, state, ref);

  // ... rest of component
};
```

## Supported Locales

Current support includes:

- `en` - English (default)
- `de` - German
- `es` - Spanish
- `fr-FR` - French (France)
- `pt-BR` - Portuguese (Brazil)

## Best Practices

### âœ… DO

- Use i18n for ALL user-facing text that needs translation
- Keep messages concise and clear
- Provide meaningful descriptions for translators
- Use proper grammar and punctuation in default messages
- Test with different locales to ensure proper text rendering

### Guidelines to Follow

- Always internationalize aria-labels and user-facing text
- Use clear, user-friendly language in default messages
- Keep translated strings intact (avoid concatenation)
- Design layouts to accommodate different text lengths across languages
- Use i18n only for user-facing content, not internal/debug messages

## Validation Checklist

When creating or reviewing i18n files:

- [ ] File follows naming convention: `{component}.i18n.ts`
- [ ] All message IDs follow pattern: `Nimbus.{Component}.{key}`
- [ ] Each message has id, description, and defaultMessage
- [ ] Descriptions clearly explain context for translators
- [ ] Default messages use proper grammar and punctuation
- [ ] **Messages exported using named export: `export const messages = {...}`**
- [ ] **Component assessed for i18n need: has default labels/aria-labels?**
- [ ] **Components with multiple parts use single shared i18n file**
- [ ] Component imports message strings correctly:
      `import { componentMessagesStrings } from "./component.messages"`
- [ ] Component uses `useLocalizedStringFormatter` hook:
      `import { useLocalizedStringFormatter } from "@/hooks"`
- [ ] Component calls `msg.format("key")` for simple string messages
- [ ] Component calls `msg.format("key", { variableName: value })` for variable
      messages
- [ ] All user-facing text is internationalized
- [ ] aria-labels are properly localized
- [ ] No hardcoded strings in component

## Related Documentation

- [NimbusProvider Documentation](../../packages/nimbus/src/components/nimbus-provider/nimbus-provider.mdx#set-up-locale) -
  User-facing guide for setting up locale
- [Main Component Guidelines](./main-component.md) - Component implementation
  with i18n
- [Accessibility Guidelines](./architecture-decisions.md) - Accessibility
  requirements
- [React Aria Integration](./architecture-decisions.md#react-aria-requirements) -
  Using React Aria with i18n

---

[â† Back to Component Guidelines](../component-guidelines.md)
