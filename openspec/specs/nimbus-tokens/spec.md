# Specification: @commercetools/nimbus-tokens

## Overview

The @commercetools/nimbus-tokens package is the single source of truth for all design tokens in the Nimbus design system. It transforms W3C Design Token Community Group (DTCG) standard tokens into multiple platform-specific formats using Style Dictionary, providing 24 token categories with 2000+ individual tokens.

**Package:** `@commercetools/nimbus-tokens`
**Version:** 2.1.0
**Build Tool:** Style Dictionary v4.3.0
**Source:** `src/base/tokens.json` (7,403 lines, DTCG format)

## Purpose

This specification defines the cross-cutting concerns for token generation, transformation, and distribution. Category-specific token requirements are documented in individual subspecifications.

## Requirements

### Requirement: DTCG-Compliant Token Source
The system SHALL maintain design tokens in W3C DTCG standard format.

#### Scenario: Token definition
- **WHEN** a token is defined in src/base/tokens.json
- **THEN** SHALL use `$type` property for token type declaration
- **AND** SHALL use `$value` property for token value
- **AND** SHALL support token references with curly brace syntax `{category.subcategory.token}`

#### Scenario: Token composition
- **WHEN** a token references another token
- **THEN** SHALL resolve references during build transformation
- **AND** SHALL support multi-level reference chains
- **AND** SHALL detect and report circular references

### Requirement: Multi-Platform Output Generation
The system SHALL generate platform-specific token outputs.

#### Scenario: CSS variable generation
- **WHEN** Style Dictionary build runs
- **THEN** SHALL output design-tokens.css with 2,290+ CSS custom properties
- **AND** SHALL use kebab-case naming (`--category-subcategory-token-name`)
- **AND** SHALL convert colors to HSL format
- **AND** SHALL generate shadow shorthand notation

#### Scenario: TypeScript token generation
- **WHEN** Style Dictionary build runs
- **THEN** SHALL output design-tokens.ts with typed object literals
- **AND** SHALL use PascalCase for category names
- **AND** SHALL mark exports as `as const` for type inference
- **AND** SHALL provide IDE autocompletion with value visibility

#### Scenario: Chakra UI format generation
- **WHEN** Style Dictionary build runs
- **THEN** SHALL output theme-tokens.ts with Chakra-specific `{ value }` wrapper syntax
- **AND** SHALL merge light/dark mode values into `{ _light, _dark }` objects
- **AND** SHALL be compatible with `defineTokens()` function

### Requirement: Style Dictionary Configuration
The system SHALL use Style Dictionary for token transformation.

#### Scenario: Build execution
- **WHEN** `pnpm build` is run
- **THEN** SHALL read src/base/tokens.json as source
- **AND** SHALL apply tokens-studio preprocessor for DTCG compatibility
- **AND** SHALL transform tokens using custom transform groups
- **AND** SHALL output to css/, src/generated/ts/, and src/generated/chakra/ directories

### Requirement: Custom Transformers
The system SHALL provide custom transformers for platform-specific formats.

#### Scenario: Chakra transformer
- **WHEN** generating Chakra format
- **THEN** SHALL convert `$value` to `value` property
- **AND** SHALL merge light/dark color pairs into `{ _light, _dark }` objects
- **AND** SHALL recursively process nested token objects
- **AND** SHALL remove Style Dictionary metadata

### Requirement: Multiple Entry Points
The system SHALL provide separate exports for different consumers.

#### Scenario: Main package export
- **WHEN** importing from "@commercetools/nimbus-tokens"
- **THEN** SHALL export `themeTokens` (Chakra format)
- **AND** SHALL export `designTokens` (TypeScript format)

#### Scenario: Direct format imports
- **WHEN** importing from "@commercetools/nimbus-tokens/generated/ts"
- **THEN** SHALL provide designTokens object
- **WHEN** importing from "@commercetools/nimbus-tokens/generated/chakra"
- **THEN** SHALL provide themeTokens object

### Requirement: Color Token Source
The system SHALL accept colors from @commercetools/color-tokens package.

#### Scenario: Color import
- **WHEN** tokens.json is updated
- **THEN** SHALL reference colors generated by color-tokens package
- **AND** SHALL include system palettes (Radix UI)
- **AND** SHALL include brand palettes (commercetools)
- **AND** SHALL include semantic palette mappings

### Requirement: Nimbus Package Integration
The system SHALL be consumed by @commercetools/nimbus package.

#### Scenario: Token consumption
- **WHEN** Nimbus components reference tokens
- **THEN** SHALL import themeTokens for Chakra theme configuration
- **AND** SHALL wrap with defineTokens() function
- **AND** SHALL extend with semantic token layer
- **AND** SHALL use in component recipes via token references
